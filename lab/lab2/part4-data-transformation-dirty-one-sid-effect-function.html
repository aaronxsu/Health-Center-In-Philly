<!DOCTYPE html>
<html>
  <head>
    <!--stylesheet imports-->
    <link rel="stylesheet" href="leaflet.css" />
  </head>
  <body>

    <!--left panel-->
    <div style="position: absolute; left: 0px; width: 400px; top: 0; bottom: 0;"></div>
    <!--map-->
    <div id="map" style="position: absolute; right: 0; left: 400px; top: 0; bottom: 0;"></div>

    <!--javascript imports-->
    <script src="leaflet.js"></script>
    <!--script src="part4-data-clean.js"></script-->
    <script src="partX-data-dirty.js"></script>

    <script>

    /* =====================

    # Lab 1, Part 4 â€” Data Transformation

    ## Introduction

    We're going to explore Philadelphia Bike Share locations. We will be using data from OpenDataPhilly (https://www.opendataphilly.org/dataset/bike-share-stations).

    We have converted the data from OpenDataPhilly into an array of arrays similar to part3. However, our arrays for bike share data have an extra data point:

    1. lat
    2. lng
    3. label
    4. number of bike share docks at the station

    This data is assigned to variable "data" in the code below. You can view the entire array in the part4-data-clean.js file.

    ## Data Processing

    We are only interested in bike share stations with more than 20 docks. Programmatically create a new array, variable "dataFiltered" that only contains locations with more than 20 docks.

    ## Add Markers to the map

    Loop through this filtered array, adding all markers to the map.

    ## Working with Dirty Data

    Often, our data will contain inconsistencies that can cause problems in our code. In the code below, switch out "bikeArrayClean" with "bikeArrayDirty". If you reload your map now, the markers should be gone. You can review the dirty data in part4-data-dirty.js.

    Without modifying part4-data-dirty.js, change your code to account for the dirty data.

    ===================== */


    /*********************

    Start working with dirty data.

    *********************/


    var map = L.map('map', {
    center: [39.9522, -75.1639],
    zoom: 14
    });
    var Stamen_TonerLite = L.tileLayer('http://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.{ext}', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      subdomains: 'abcd',
      minZoom: 0,
      maxZoom: 20,
      ext: 'png'
    }).addTo(map);

    var dataDirty = bikeArrayDirty;


    //This function may have some issues, so it is not used in other funtions.
    //Check if the string is all upper case
    var isUpperCase = function (string){
      tempStr = string;
      tempStr.toUpperCase();
      if(tempStr === string){
        return true;
      }
      else{
        return false;
      }
    }

    //Check if the string contains the number of stations
    var isStation = function (string){
      return string.includes('stations');
    }

    //Change string to stations numbers
    var toStationCounts = function (string){
      return parseInt(string);
    }

    //Check if the string is latitude in our study area
    var isLat = function (string){
      if (parseFloat(string)>39 && parseFloat(string)<39.99999){
        return true;
      }
      else{
        return false;
      }
    }

    //Check if the string is longitude in our study area
    var isLng = function (string){
      if (parseFloat(string)<0){
        return true;
      }
      else{
        return false;
      }
    }

    //check if the string is an address
    var isAddress = function (string){
      if ((string.includes('&') || string.includes(',')) && !(string.includes('.'))){
        return true;
      }
      else{
        return false;
      }
    }

    //Filter the original data, get rid of locations with stations less than 20
    var dataFilter = function (data){
        var dataFiltered = [];

        for (var i = 0; i < data.length; i++){
          for (var j = 0; j< data[i].length; j++){
            if (isStation(data[i][j]) && toStationCounts(data[i][j]) > 20){
              dataFiltered.push(data[i]);
            }
          }
        }

        return dataFiltered;
    }

    /*Clean the data so that each place contains latitude (number), longitude(number),
    address(string), and number of stations(number)*/
    var dataClean = function (data){
      var dataCleaned = [];
      var lng;
      var lat;
      var stations;
      var address="";

      for(var i = 0; i < data.length; i++){
        for(var j = 0; j< data[i].length; j++){
          //var tempTest = data[i][j];
          if(isLat(data[i][j])){
            lat = parseFloat(data[i][j]);
          }
          else if(isLng(data[i][j])){
            lng = parseFloat(data[i][j]);
          }
          else if(isAddress(data[i][j])){
            address = data[i][j];
          }
          else{
            stations = parseFloat(data[i][j]);
          }
        }
        dataCleaned.push([lat,lng,address,stations]);
      }

      return dataCleaned;
    }

    //Add location markers to the map
    var addMarker = function (data){
      for(var k = 0; k < data.length; k++)
      {
        var popUp = "<b>"+ data[k][2]+"</b>";
        var marker = L.marker([data[k][0], data[k][1]]).addTo(map);
        marker.bindPopup(popUp).openPopup();
      }
    }


    addMarker(dataClean(dataFilter(dataDirty)));

    /* =====================

    End code to add markers to map

    ===================== */



    </script>
  </body>
</html>
